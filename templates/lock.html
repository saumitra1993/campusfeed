<!DOCTYPE html>
<html class="csstransforms csstransforms3d csstransitions no-js skrollr skrollr-desktop" lang="en">
    <head>
        <title>Campusfeed- Everything about college, in one place.</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
       <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" />
        <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Oswald:300,400,700" />
        <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <!-- font awesome-->
        <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
        <!-- Animation -->
        <link rel="stylesheet" type="text/css" id="animationcss" href="css/animation.css" />
        <!-- bootstrap -->
        <!-- custom style -->
        <link rel="stylesheet" type="text/css" href="css/style.css" />
        <!-- custom scrollbar -->
        <link rel="stylesheet" type="text/css" href="css/custom-scrollbar.css">
        <!-- responsive -->
        <link rel="stylesheet" type="text/css" href="css/responsive.css">
        <!-- responsive -->
        <link rel="stylesheet" type="text/css" href="css/patternLock.css">
        
        <script src="js/jquery-1.11.0.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/lib/processing.js"></script>
        <script type="text/javascript" src="/_ah/channel/jsapi"></script>
    </head>

    <body >
      
            <!-- header end --> 
           
      <div class="col-md-offset-3">
        <canvas id="canvas1" ></canvas>
      </div> 
              
     
    </body>
</html>

<script>
  var code = [];
  var htop = [60,40,80,80,20,80,20,40];
  var h =  [200,200,200,200,200,200,200,200];
  var ytop = [230,230,230,230,230,230,230,230];
  var y = [290,270,310,310,250,310,250,270];
  var line = [230,230,230,230,230,230,230,230];
  var flag=0;
  var new_message = 0;
  var PI = 3.142;
    $.ajax({
        url: "/channeltoken?&channel_id=lock",
        type: "GET",
        dataType: "json",
        success: function (data, textStatus, jqXHR) {
          token = data.token;
          var channel = new goog.appengine.Channel(token);
          socket = channel.open();
          socket.onmessage = function(message){
            var result=JSON.parse(message.data);
            console.log(result);
            code = result.code;
            new_message = 1;
          };
          socket.onerror = function(error) {
            console.log('Socket Error');
            console.log(error);
          };
          socket.onclose = function() {
            console.log('Socket Closed');
            console.log('Re-opening');
          };
        },
        error: function (jqXHR, textStatus, exception) {
          console.log(exception);
        }
    });
    function sketchProc(processing) {
        processing.setup = function(){
            processing.size(500,400,processing.WEBGL);
            
        };
        
        processing.draw = function(){
          processing.background(128);
          processing.translate(120,0);
         /* if(flag==1){
            processing.pushMatrix();
            processing.rotateX(PI/10.0);
          }*/
          p1 = processing.rect(10,y[0],20,h[0]);
         /* if(flag==1){
            processing.popMatrix();
          }*/
          processing.rect(10,ytop[0],20,htop[0]);     //how much to pick up
          processing.line(20,line[0],20,100);

          /*if(flag==1){
            processing.pushMatrix();
            processing.rotateX(PI/10.0);
          }*/
          p2 = processing.rect(40,y[1],20,h[1]);
          /*if(flag==1){
            processing.popMatrix();
          }*/
          processing.rect(40,ytop[1],20,htop[1]);
          processing.line(50,line[1],50,100);

          /*if(flag==1){
            processing.pushMatrix();
            processing.rotateX(PI/10.0);
          }*/
          p3 = processing.rect(70,y[2],20,h[2]);
          /*if(flag==1){
            processing.popMatrix();
          }*/
          processing.rect(70,ytop[2],20,htop[2]);
          processing.line(80,line[2],80,100);

          /*if(flag==1){
            processing.pushMatrix();
            processing.rotateX(PI/10.0);
          }*/
          p4 = processing.rect(100,y[3],20,h[3]);
          /*if(flag==1){
            processing.popMatrix();
          }*/
          processing.rect(100,ytop[3],20,htop[3]);
          processing.line(110,line[3],110,100);

          /*if(flag==1){
            processing.pushMatrix();
            processing.rotateX(PI/10.0);
          }*/
          p5 = processing.rect(130,y[4],20,h[4]);
          /*if(flag==1){
            processing.popMatrix();
          }*/
          processing.rect(130,ytop[4],20,htop[4]);
          processing.line(140,line[4],140,100);

          /*if(flag==1){
            processing.pushMatrix();
            processing.rotateX(PI/10.0);
          }*/
          p6 = processing.rect(160,y[5],20,h[5]);
          /*if(flag==1){
            processing.popMatrix();
          }*/
          processing.rect(160,ytop[5],20,htop[5]);
          processing.line(170,line[5],170,100);

          /*if(flag==1){
            processing.pushMatrix();
            processing.rotateX(PI/10.0);
          }*/
          p7 = processing.rect(190,y[6],20,h[6]);
          /*if(flag==1){
            processing.popMatrix();
          }*/
          processing.rect(190,ytop[6],20,htop[6]);
          processing.line(200,line[6],200,100);

          /*if(flag==1){
            processing.pushMatrix();
            processing.rotateX(PI/10.0);
          }*/
          p8 = processing.rect(220,y[7],20,h[7]);
          /*if(flag==1){
            processing.popMatrix();
          }*/
          processing.rect(220,ytop[7],20,htop[7]);
          processing.line(230,line[7],230,100);

          processing.rect(0,80,250,20);

          if(code.length>0 && new_message == 1){
            for(var k=0;k<code.length;k++){
              var res = code[k].split('-');
              var height = res.length;
              console.log(height);
              ytop[k] = ytop[k] - height*20;
              y[k] = y[k] - height*20;
              console.log("y = "+y[k]);
              line[k] = line[k] - height*20;
            }
            
            flag = 1;
            for(k=0;k<8;k++){
              if(y[k] != 210){
                flag = 0;
              }
            }
            console.log(flag);
            new_message = 0;
            setTimeout(function(){ 

              ytop = [230,230,230,230,230,230,230,230];
              y = [290,270,310,310,250,310,250,270];
              line = [230,230,230,230,230,230,230,230]; 
            }, 3000);
           
            /*if(flag == 1){
                p1.rotateZ(10);
                p2.rotateZ(10);
                p3.rotateZ(10);
                p4.rotateZ(10);
                p5.rotateZ(10);
                p6.rotateZ(10);
                p7.rotateZ(10);
                p8.rotateZ(10);
            }*/
          }
        };
    }
    var canvas = document.getElementById("canvas1");
    // attaching the sketchProc function to the canvas
    var processingInstance = new Processing(canvas, sketchProc);
</script>